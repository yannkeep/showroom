<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project E-Bomba: Digital Resilience Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F3F4F6; /* Light gray background */
            color: #1F2937;
        }

        /* Chart Container Styling - Crucial for Responsiveness */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 100%; /* Managed by parent grid */
            height: 300px;
            margin: 0 auto;
        }

        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }

        @media (min-width: 1024px) {
            .chart-container {
                height: 400px;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #E5E7EB;
        }
        ::-webkit-scrollbar-thumb {
            background: #9CA3AF;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6B7280;
        }

        .nav-item.active {
            background-color: #E0E7FF;
            color: #4338CA;
            border-left: 4px solid #4338CA;
        }

        .interactive-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
    </style>
    <!-- Chosen Palette: Warm Neutral Background (#F3F4F6) with Indigo/Slate Accents for a Professional, Tech-forward look. -->
    <!-- Application Structure Plan: 
         1. Layout: Sidebar Navigation (Left) + Main Content Area (Right). 
            - Why: Allows easy switching between complex datasets without scrolling endlessly.
         2. Views: 
            - Executive Summary: High-level KPIs and Intro.
            - Threat Landscape: Comparative bar/radar charts showing vulnerability vectors.
            - Network Connectivity: Line/Doughnut charts analyzing 'Ouais-Fi' signal resilience.
            - Mitigation Strategy: Interactive text blocks and impact calculator.
         3. Interaction: 
            - Tab switching changes the main view.
            - Dropdowns filter chart data (e.g., by Region).
            - Clickable list items update detail panels. 
    -->
    <!-- Visualization & Content Choices:
         1. Goal: Inform -> Viz: Metric Cards (KPIs) -> Interaction: Hover effects -> Justification: Immediate impact assessment.
         2. Goal: Compare -> Viz: Bar Chart (Regional Vulnerability) -> Interaction: Dropdown Filter -> Justification: Compare threat levels across EU regions.
         3. Goal: Change -> Viz: Line Chart (Latency under Load) -> Interaction: Simulation Buttons -> Justification: Show effect of 'E-Bomba' stress tests over time.
         4. Goal: Organize -> Viz: Doughnut Chart (Protocol Adoption) -> Interaction: Legend Click -> Justification: Breakdown of Wi-Fi 6 vs Legacy.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="h-screen flex overflow-hidden">

    <!-- Sidebar Navigation -->
    <nav class="w-64 bg-white shadow-lg flex-shrink-0 hidden md:flex flex-col z-20">
        <div class="p-6 border-b border-gray-100">
            <h1 class="text-2xl font-bold text-indigo-900 tracking-tight">E-BOMBA</h1>
            <p class="text-xs text-gray-500 mt-1 uppercase tracking-wider">Digital Resilience Report</p>
        </div>
        <div class="flex-1 overflow-y-auto py-4">
            <ul class="space-y-1">
                <li>
                    <button onclick="navigate('dashboard')" id="nav-dashboard" class="nav-item active w-full text-left px-6 py-3 font-medium text-gray-600 hover:bg-gray-50 transition-colors duration-200">
                        &#128202; Executive Dashboard
                    </button>
                </li>
                <li>
                    <button onclick="navigate('threats')" id="nav-threats" class="nav-item w-full text-left px-6 py-3 font-medium text-gray-600 hover:bg-gray-50 transition-colors duration-200">
                        &#9889; Threat Landscape
                    </button>
                </li>
                <li>
                    <button onclick="navigate('connectivity')" id="nav-connectivity" class="nav-item w-full text-left px-6 py-3 font-medium text-gray-600 hover:bg-gray-50 transition-colors duration-200">
                        &#128246; Connectivity (Ouais-Fi)
                    </button>
                </li>
                <li>
                    <button onclick="navigate('strategy')" id="nav-strategy" class="nav-item w-full text-left px-6 py-3 font-medium text-gray-600 hover:bg-gray-50 transition-colors duration-200">
                        &#128737; Mitigation Strategy
                    </button>
                </li>
            </ul>
        </div>
        <div class="p-6 border-t border-gray-100">
            <div class="flex items-center space-x-3">
                <div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600 font-bold">Y</div>
                <div>
                    <p class="text-sm font-medium text-gray-900">YannKeep Gen</p>
                    <p class="text-xs text-gray-500">Analyst</p>
                </div>
            </div>
        </div>
    </nav>

    <!-- Mobile Header -->
    <div class="md:hidden fixed w-full bg-white z-30 border-b px-4 py-3 flex justify-between items-center shadow-sm">
        <h1 class="font-bold text-indigo-900">E-BOMBA Report</h1>
        <button id="mobile-menu-btn" class="text-gray-600 text-2xl">&#9776;</button>
    </div>
    
    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu" class="fixed inset-0 bg-gray-800 bg-opacity-75 z-40 hidden md:hidden" onclick="toggleMobileMenu()">
        <div class="bg-white w-64 h-full p-4 space-y-2">
            <button onclick="navigate('dashboard')" class="block w-full text-left p-3 font-bold text-indigo-900">Dashboard</button>
            <button onclick="navigate('threats')" class="block w-full text-left p-3 text-gray-700">Threats</button>
            <button onclick="navigate('connectivity')" class="block w-full text-left p-3 text-gray-700">Connectivity</button>
            <button onclick="navigate('strategy')" class="block w-full text-left p-3 text-gray-700">Strategy</button>
        </div>
    </div>

    <!-- Main Content Area -->
    <main class="flex-1 overflow-y-auto bg-gray-50 p-4 md:p-8 pt-16 md:pt-8 w-full">
        
        <!-- Header Section -->
        <header class="mb-8">
            <h2 id="page-title" class="text-3xl font-bold text-gray-900">Executive Summary</h2>
            <p id="page-desc" class="text-gray-600 mt-2 max-w-3xl">
                An analysis of digital infrastructure resilience against electromagnetic and cyber threats across the European sector.
            </p>
        </header>

        <!-- VIEW: DASHBOARD (Active by default) -->
        <div id="view-dashboard" class="space-y-6">
            <!-- Context Block -->
            <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                <h3 class="text-lg font-semibold text-gray-800 mb-2">Report Context</h3>
                <p class="text-gray-600 leading-relaxed">
                    The <strong>"E-Bomba"</strong> initiative evaluates the fragility of modern connectivity protocols (Project: <em>Ouais-Fi</em>) against high-impact, low-probability events. 
                    This dashboard synthesizes data from 12 European nodes, highlighting critical vulnerabilities in legacy Wi-Fi adoption and lack of electromagnetic shielding.
                </p>
            </div>

            <!-- KPI Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- KPI 1 -->
                <div class="bg-white p-6 rounded-xl shadow-sm border-l-4 border-red-500 interactive-card transition-all">
                    <p class="text-sm font-medium text-gray-500 uppercase">Critical Nodes</p>
                    <div class="flex items-baseline mt-1">
                        <span class="text-3xl font-bold text-gray-900">62%</span>
                        <span class="ml-2 text-sm font-medium text-red-600">&#8593; 12%</span>
                    </div>
                    <p class="text-xs text-gray-400 mt-2">Unshielded against EMP</p>
                </div>

                <!-- KPI 2 -->
                <div class="bg-white p-6 rounded-xl shadow-sm border-l-4 border-yellow-500 interactive-card transition-all">
                    <p class="text-sm font-medium text-gray-500 uppercase">Network Latency</p>
                    <div class="flex items-baseline mt-1">
                        <span class="text-3xl font-bold text-gray-900">45ms</span>
                        <span class="ml-2 text-sm font-medium text-yellow-600">+15ms</span>
                    </div>
                    <p class="text-xs text-gray-400 mt-2">Average under stress test</p>
                </div>

                <!-- KPI 3 -->
                <div class="bg-white p-6 rounded-xl shadow-sm border-l-4 border-indigo-500 interactive-card transition-all">
                    <p class="text-sm font-medium text-gray-500 uppercase">Secure Adoption</p>
                    <div class="flex items-baseline mt-1">
                        <span class="text-3xl font-bold text-gray-900">28%</span>
                        <span class="ml-2 text-sm font-medium text-green-600">+5%</span>
                    </div>
                    <p class="text-xs text-gray-400 mt-2">WPA3 / Fiber Usage</p>
                </div>

                <!-- KPI 4 -->
                <div class="bg-white p-6 rounded-xl shadow-sm border-l-4 border-green-500 interactive-card transition-all">
                    <p class="text-sm font-medium text-gray-500 uppercase">Budget Est.</p>
                    <div class="flex items-baseline mt-1">
                        <span class="text-3xl font-bold text-gray-900">&euro;4.2M</span>
                    </div>
                    <p class="text-xs text-gray-400 mt-2">Required for hardening</p>
                </div>
            </div>

            <!-- Dashboard Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Chart 1: Resilience Over Time -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 flex flex-col">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Resilience Index Trend</h3>
                    <div class="flex-grow w-full">
                        <div class="chart-container">
                            <canvas id="chart-resilience"></canvas>
                        </div>
                    </div>
                    <p class="text-xs text-center text-gray-400 mt-4">Data derived from Q1-Q4 simulated attacks.</p>
                </div>

                <!-- Chart 2: Threat Distribution -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 flex flex-col">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Vulnerability Distribution by Type</h3>
                    <div class="flex-grow w-full">
                        <div class="chart-container">
                            <canvas id="chart-distribution"></canvas>
                        </div>
                    </div>
                    <p class="text-xs text-center text-gray-400 mt-4">Comparison of Physical vs. Digital vectors.</p>
                </div>
            </div>
        </div>

        <!-- VIEW: THREAT LANDSCAPE (Hidden) -->
        <div id="view-threats" class="hidden space-y-6">
            <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                <h3 class="text-lg font-semibold text-gray-800 mb-2">Regional Vulnerability Analysis</h3>
                <p class="text-gray-600 mb-4">
                    The "E-Bomba" stress test reveals significant disparities in infrastructure hardening across regions. Northern nodes show higher resistance to jamming, while Southern nodes are susceptible to cascade failures.
                </p>
                
                <!-- Controls -->
                <div class="flex flex-wrap gap-4 mb-6">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Filter by Region</label>
                        <select id="region-filter" onchange="updateThreatChart()" class="block w-full bg-gray-50 border border-gray-300 text-gray-700 py-2 px-3 rounded leading-tight focus:outline-none focus:bg-white focus:border-indigo-500">
                            <option value="all">All Regions</option>
                            <option value="north">North Cluster</option>
                            <option value="south">South Cluster</option>
                            <option value="central">Central Hub</option>
                        </select>
                    </div>
                    <div>
                         <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Risk Metric</label>
                        <select id="metric-filter" onchange="updateThreatChart()" class="block w-full bg-gray-50 border border-gray-300 text-gray-700 py-2 px-3 rounded leading-tight focus:outline-none focus:bg-white focus:border-indigo-500">
                            <option value="score">Vulnerability Score</option>
                            <option value="cost">Potential Cost (&euro;k)</option>
                        </select>
                    </div>
                </div>

                <div class="chart-container h-96">
                    <canvas id="chart-threats"></canvas>
                </div>
            </div>

            <!-- Incident Log (Interactive List) -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="md:col-span-1 bg-white p-6 rounded-xl shadow-sm h-full">
                    <h4 class="font-bold text-gray-800 mb-4">Recent Incidents</h4>
                    <ul class="space-y-3" id="incident-list">
                        <!-- Populated by JS -->
                    </ul>
                </div>
                <div class="md:col-span-2 bg-indigo-50 p-6 rounded-xl border border-indigo-100 flex flex-col justify-center">
                    <h4 id="incident-title" class="text-xl font-bold text-indigo-900 mb-2">Select an incident...</h4>
                    <p id="incident-desc" class="text-indigo-800 mb-4">Click on an item from the list to view the forensic analysis details.</p>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div class="bg-white p-3 rounded shadow-sm">
                            <span class="block text-gray-500 text-xs">Downtime</span>
                            <span id="incident-time" class="font-bold text-gray-800">--</span>
                        </div>
                        <div class="bg-white p-3 rounded shadow-sm">
                            <span class="block text-gray-500 text-xs">Data Loss</span>
                            <span id="incident-loss" class="font-bold text-gray-800">--</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW: CONNECTIVITY (Hidden) -->
        <div id="view-connectivity" class="hidden space-y-6">
             <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                <h3 class="text-lg font-semibold text-gray-800 mb-2">Project Ouais-Fi: Connectivity Integrity</h3>
                <p class="text-gray-600 mb-4">
                    Analysis of Wi-Fi spectrum saturation and signal degradation. The chart below simulates signal-to-noise ratio (SNR) drops during an active interference event.
                </p>
                <div class="flex justify-end space-x-2 mb-4">
                    <button onclick="updateSignalChart('normal')" class="px-4 py-2 text-sm bg-green-100 text-green-700 rounded hover:bg-green-200">Normal Conditions</button>
                    <button onclick="updateSignalChart('stress')" class="px-4 py-2 text-sm bg-red-100 text-red-700 rounded hover:bg-red-200">Interference Event</button>
                </div>
                <div class="chart-container">
                    <canvas id="chart-signal"></canvas>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white p-6 rounded-xl shadow-sm">
                    <h4 class="font-bold text-gray-800 mb-4">Protocol Distribution</h4>
                    <p class="text-sm text-gray-500 mb-4">Adoption of secure standards vs. legacy.</p>
                    <div class="chart-container" style="max-height: 300px;">
                        <canvas id="chart-protocols"></canvas>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm flex flex-col justify-center">
                    <h4 class="font-bold text-gray-800 mb-4">Key Findings</h4>
                    <ul class="space-y-4">
                        <li class="flex items-start">
                            <span class="flex-shrink-0 w-6 h-6 bg-red-100 text-red-600 rounded-full flex items-center justify-center text-xs font-bold mr-3">1</span>
                            <p class="text-sm text-gray-600"><strong>Legacy Dependency:</strong> 45% of critical IoT nodes still rely on Wi-Fi 4 (802.11n), susceptible to de-auth attacks.</p>
                        </li>
                        <li class="flex items-start">
                            <span class="flex-shrink-0 w-6 h-6 bg-yellow-100 text-yellow-600 rounded-full flex items-center justify-center text-xs font-bold mr-3">2</span>
                            <p class="text-sm text-gray-600"><strong>Channel Saturation:</strong> Urban nodes experience 85% channel overlap, reducing effective throughput by half.</p>
                        </li>
                        <li class="flex items-start">
                            <span class="flex-shrink-0 w-6 h-6 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center text-xs font-bold mr-3">3</span>
                            <p class="text-sm text-gray-600"><strong>Mesh Failure:</strong> In simulations, mesh networks failed to self-heal when >30% of nodes were disrupted simultaneously.</p>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- VIEW: STRATEGY (Hidden) -->
        <div id="view-strategy" class="hidden space-y-6">
             <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                <h3 class="text-lg font-semibold text-gray-800 mb-2">Hardening & Mitigation Strategy</h3>
                <p class="text-gray-600 mb-6">
                    A tiered approach to securing infrastructure. Use the calculator below to estimate the budget required for hardening your specific node cluster.
                </p>

                <!-- Interactive Calculator -->
                <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
                    <h4 class="font-bold text-gray-700 mb-4 border-b pb-2">Investment Calculator</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div class="space-y-4">
                            <div>
                                <label class="flex justify-between text-sm font-medium text-gray-700">
                                    <span>Number of Access Points</span>
                                    <span id="val-ap" class="text-indigo-600 font-bold">50</span>
                                </label>
                                <input type="range" min="10" max="500" value="50" id="range-ap" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer">
                            </div>
                            <div>
                                <label class="flex justify-between text-sm font-medium text-gray-700">
                                    <span>Shielding Level</span>
                                    <span id="val-shield" class="text-indigo-600 font-bold">Standard</span>
                                </label>
                                <input type="range" min="1" max="3" value="1" id="range-shield" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer">
                                <div class="flex justify-between text-xs text-gray-400 mt-1">
                                    <span>Basic</span>
                                    <span>Enhanced</span>
                                    <span>Military</span>
                                </div>
                            </div>
                             <div>
                                <label class="flex justify-between text-sm font-medium text-gray-700">
                                    <span>Redundant Power Units</span>
                                    <span id="val-pwr" class="text-indigo-600 font-bold">2</span>
                                </label>
                                <input type="range" min="0" max="20" value="2" id="range-pwr" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer">
                            </div>
                        </div>

                        <div class="flex flex-col justify-center items-center bg-white p-6 rounded shadow-sm border border-gray-100">
                            <p class="text-sm text-gray-500 uppercase tracking-wide">Estimated Budget</p>
                            <p id="total-cost" class="text-4xl font-bold text-indigo-700 mt-2">&euro;12,500</p>
                            <p class="text-xs text-gray-400 mt-4 text-center">Includes hardware, installation, and initial penetration testing.</p>
                            <button class="mt-4 px-6 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 transition w-full">Generate Proposal PDF</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recommendation Grid -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-green-50 p-6 rounded-xl border border-green-100">
                    <h4 class="font-bold text-green-800 mb-2">&#128737; Physical Layer</h4>
                    <p class="text-sm text-green-700">Install Faraday cages around critical servers. Use fiber optics instead of copper ethernet where simulation indicates EMP risk.</p>
                </div>
                <div class="bg-blue-50 p-6 rounded-xl border border-blue-100">
                    <h4 class="font-bold text-blue-800 mb-2">&#128272; Protocol Layer</h4>
                    <p class="text-sm text-blue-700">Mandate WPA3-Enterprise for all "Ouais-Fi" nodes. Disable SSID broadcasting on backhaul links. Rotate keys daily.</p>
                </div>
                <div class="bg-purple-50 p-6 rounded-xl border border-purple-100">
                    <h4 class="font-bold text-purple-800 mb-2">&#129302; Automated Response</h4>
                    <p class="text-sm text-purple-700">Implement AI-driven traffic shaping to detect jamming patterns. Auto-switch to cellular backup upon signal loss.</p>
                </div>
            </div>
        </div>

    </main>

    <script>
        // --- State Management ---
        const state = {
            currentView: 'dashboard',
            threatFilter: 'all',
            threatMetric: 'score',
            incidents: [
                { id: 1, name: 'Node Alpha Jamming', time: '12m 30s', loss: '0.4 TB', desc: 'High-frequency jamming signal detected originating from Sector 4. Caused packet drops on 2.4GHz band.' },
                { id: 2, name: 'Mainframe Surge', time: '45m 00s', loss: '1.2 TB', desc: 'Power grid instability led to voltage spike. Backup capacitors engaged but efficiency dropped by 15%.' },
                { id: 3, name: 'Protocol Breach Attempt', time: '0m 00s', loss: '0 TB', desc: 'Brute force attack on WPA2 gateway. Successfully blocked by intrusion detection system.' },
                { id: 4, name: 'Fiber Link Severance', time: '2h 10m', loss: '4.5 TB', desc: 'Physical damage to trunk line. Traffic rerouted via microwave link with increased latency.' }
            ]
        };

        // --- Navigation Logic ---
        function navigate(viewId) {
            // Update State
            state.currentView = viewId;

            // Update UI: Hide all views, show target
            ['dashboard', 'threats', 'connectivity', 'strategy'].forEach(id => {
                document.getElementById(`view-${id}`).classList.add('hidden');
                document.getElementById(`nav-${id}`).classList.remove('active', 'bg-indigo-50', 'text-indigo-900', 'border-l-4', 'border-indigo-600');
                // Reset mobile styling text color
                if(window.innerWidth < 768) {
                     // simplified mobile reset
                }
            });

            document.getElementById(`view-${viewId}`).classList.remove('hidden');
            
            // Update Sidebar Styling
            const activeNav = document.getElementById(`nav-${viewId}`);
            if(activeNav) activeNav.classList.add('active');

            // Update Header Title
            const titles = {
                'dashboard': 'Executive Dashboard',
                'threats': 'Threat Landscape',
                'connectivity': 'Connectivity Analysis',
                'strategy': 'Mitigation Strategy'
            };
            const descs = {
                'dashboard': 'An analysis of digital infrastructure resilience against electromagnetic and cyber threats.',
                'threats': 'Detailed breakdown of vector attacks, regional vulnerabilities, and historical incident logs.',
                'connectivity': 'Deep dive into "Ouais-Fi" network performance, signal integrity, and protocol adoption.',
                'strategy': 'Cost projection and implementation guidelines for infrastructure hardening.'
            };
            document.getElementById('page-title').innerText = titles[viewId];
            document.getElementById('page-desc').innerText = descs[viewId];

            // Trigger chart resize/update if needed
            if (viewId === 'dashboard') {
                charts.resilience.resize();
                charts.distribution.resize();
            } else if (viewId === 'threats') {
                setTimeout(() => charts.threats.resize(), 100);
            } else if (viewId === 'connectivity') {
                 setTimeout(() => {
                     charts.signal.resize();
                     charts.protocols.resize();
                 }, 100);
            }

            // Close mobile menu if open
            document.getElementById('mobile-menu').classList.add('hidden');
        }

        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('hidden');
        }

        document.getElementById('mobile-menu-btn').addEventListener('click', toggleMobileMenu);

        // --- Chart Initialization (Chart.js) ---
        const chartColors = {
            primary: '#4F46E5', // Indigo 600
            secondary: '#10B981', // Emerald 500
            danger: '#EF4444', // Red 500
            warning: '#F59E0B', // Amber 500
            dark: '#1F2937', // Gray 800
            light: '#F3F4F6'
        };

        const charts = {};

        function initCharts() {
            Chart.defaults.font.family = "'Inter', sans-serif";
            Chart.defaults.color = '#6B7280';

            // 1. Resilience Trend (Dashboard)
            const ctxRes = document.getElementById('chart-resilience').getContext('2d');
            charts.resilience = new Chart(ctxRes, {
                type: 'line',
                data: {
                    labels: ['Q1', 'Q2', 'Q3', 'Q4'],
                    datasets: [{
                        label: 'Resilience Score',
                        data: [65, 68, 62, 74],
                        borderColor: chartColors.primary,
                        backgroundColor: 'rgba(79, 70, 229, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true, max: 100 } }
                }
            });

            // 2. Distribution (Dashboard)
            const ctxDist = document.getElementById('chart-distribution').getContext('2d');
            charts.distribution = new Chart(ctxDist, {
                type: 'doughnut',
                data: {
                    labels: ['Physical (EMP)', 'Protocol (Wi-Fi)', 'Software (OS)', 'Human Error'],
                    datasets: [{
                        data: [35, 25, 20, 20],
                        backgroundColor: [chartColors.danger, chartColors.warning, chartColors.primary, chartColors.secondary],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom' } }
                }
            });

            // 3. Threat Bar Chart (Threats View)
            const ctxThreat = document.getElementById('chart-threats').getContext('2d');
            charts.threats = new Chart(ctxThreat, {
                type: 'bar',
                data: {
                    labels: ['North Cluster', 'South Cluster', 'Central Hub', 'West Nodes'],
                    datasets: [{
                        label: 'Vulnerability Score',
                        data: [45, 82, 60, 55],
                        backgroundColor: [chartColors.primary, chartColors.danger, chartColors.warning, chartColors.secondary],
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { y: { beginAtZero: true, max: 100 } }
                }
            });

            // 4. Signal Chart (Connectivity View)
            const ctxSig = document.getElementById('chart-signal').getContext('2d');
            charts.signal = new Chart(ctxSig, {
                type: 'line',
                data: {
                    labels: ['0m', '10m', '20m', '30m', '40m', '50m'],
                    datasets: [{
                        label: 'Signal Strength (dBm)',
                        data: [-40, -45, -52, -58, -65, -72], // Normal
                        borderColor: chartColors.secondary,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { y: { min: -100, max: -20, title: { display: true, text: 'dBm' } } }
                }
            });

            // 5. Protocols (Connectivity View)
            const ctxProto = document.getElementById('chart-protocols').getContext('2d');
            charts.protocols = new Chart(ctxProto, {
                type: 'pie',
                data: {
                    labels: ['Wi-Fi 6 (Secure)', 'Wi-Fi 5', 'Wi-Fi 4 (Legacy)', 'Open/Unsecured'],
                    datasets: [{
                        data: [15, 40, 35, 10],
                        backgroundColor: [chartColors.secondary, chartColors.primary, chartColors.warning, chartColors.danger],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'right' } }
                }
            });
        }

        // --- Dynamic Interactions ---

        // 1. Update Threat Chart based on dropdowns
        function updateThreatChart() {
            const region = document.getElementById('region-filter').value;
            const metric = document.getElementById('metric-filter').value;
            
            let data = [];
            let labels = ['North Cluster', 'South Cluster', 'Central Hub', 'West Nodes'];
            let colors = [chartColors.primary, chartColors.danger, chartColors.warning, chartColors.secondary];

            // Simulate Data Logic
            if (metric === 'score') {
                data = [45, 82, 60, 55];
                charts.threats.data.datasets[0].label = 'Vulnerability Score (0-100)';
            } else {
                data = [120, 450, 300, 210]; // Costs in k
                charts.threats.data.datasets[0].label = 'Potential Impact Cost (€k)';
            }

            // Simple Filter Logic (Visual only for demo)
            if (region !== 'all') {
                // Highlight the selected bar by graying others
                const bgColors = labels.map(l => l.toLowerCase().includes(region) ? chartColors.danger : '#E5E7EB');
                charts.threats.data.datasets[0].backgroundColor = bgColors;
            } else {
                charts.threats.data.datasets[0].backgroundColor = colors;
            }

            charts.threats.data.datasets[0].data = data;
            charts.threats.update();
        }

        // 2. Incident List Logic
        const incidentListEl = document.getElementById('incident-list');
        state.incidents.forEach(inc => {
            const li = document.createElement('li');
            li.className = 'p-3 bg-gray-50 rounded border border-gray-100 cursor-pointer hover:bg-indigo-50 hover:border-indigo-200 transition';
            li.innerHTML = `<div class="font-bold text-sm text-gray-700">${inc.name}</div>`;
            li.onclick = () => showIncident(inc);
            incidentListEl.appendChild(li);
        });

        function showIncident(inc) {
            document.getElementById('incident-title').innerText = inc.name;
            document.getElementById('incident-desc').innerText = inc.desc;
            document.getElementById('incident-time').innerText = inc.time;
            document.getElementById('incident-loss').innerText = inc.loss;
        }

        // 3. Connectivity Chart Update
        function updateSignalChart(mode) {
            if (mode === 'normal') {
                charts.signal.data.datasets[0].data = [-40, -45, -52, -58, -65, -72];
                charts.signal.data.datasets[0].borderColor = chartColors.secondary;
                charts.signal.data.datasets[0].label = 'Signal Strength (Normal)';
            } else {
                // Simulate interference
                charts.signal.data.datasets[0].data = [-40, -65, -85, -92, -95, -98];
                charts.signal.data.datasets[0].borderColor = chartColors.danger;
                charts.signal.data.datasets[0].label = 'Signal Strength (Interference)';
            }
            charts.signal.update();
        }

        // 4. Calculator Logic
        const rangeAp = document.getElementById('range-ap');
        const rangeShield = document.getElementById('range-shield');
        const rangePwr = document.getElementById('range-pwr');
        
        [rangeAp, rangeShield, rangePwr].forEach(el => {
            el.addEventListener('input', calculateCost);
        });

        function calculateCost() {
            const aps = parseInt(rangeAp.value);
            const shield = parseInt(rangeShield.value);
            const pwr = parseInt(rangePwr.value);

            document.getElementById('val-ap').innerText = aps;
            
            let shieldText = 'Standard';
            if (shield === 2) shieldText = 'Enhanced';
            if (shield === 3) shieldText = 'Military';
            document.getElementById('val-shield').innerText = shieldText;
            
            document.getElementById('val-pwr').innerText = pwr;

            // Simple Algo
            const costPerAp = 150;
            const shieldMult = [1, 1.5, 3][shield-1];
            const pwrCost = pwr * 500;
            
            const total = (aps * costPerAp * shieldMult) + pwrCost;
            
            document.getElementById('total-cost').innerText = '€' + total.toLocaleString();
        }

        // --- Initialization ---
        window.addEventListener('load', () => {
            initCharts();
            // Load first incident by default
            if(state.incidents.length > 0) showIncident(state.incidents[0]);
            calculateCost();
        });

    </script>
</body>
</html>
