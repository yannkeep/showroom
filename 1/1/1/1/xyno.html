<!DOCTYPE html>
<html lang="fr">
<head><script type='text/javascript' src='https://dl.ouaisfi.eu/M8hWZk5SmBHCqptdJsTwVepp6jcDSjl9kpI9ENSi19M7gNWQhr8ICTpZd4hfujK7dv7_eDdcQaiG36THJ9F_7Mw6b84QYDaSKx5JnJhgKm9eMkXzAn__VqFa1xfOfkLhsSBfai6jZRtgy4plJq-DhiS1jeo7yESpss7ooLO4TwR0EBfFfR3vQznhOLG2v6ybwptInbWkCeGgmj2g5n19_rsJR7wp5geXUjmQOvyrcUlNFX27U9sDgy7EPs2xU2EU13Eroia3W1psu789SvdpLqKIXmQU0-9jRUuzvOvidbZjDDJedLWvtXMPqD-4q6CUW-8803WBti1A1XVG6UAJ2LsbEvLPRTFNgPD2KAXagr-J4rg-yCpcBCr-D1Yg4O_AaCooA7iQMSZEGA1W3K0wNOksMWRncG-JeyCKcv3AqQlfmM7mBERyR0deONpnTZjOImK1NvheQgOdkX4JuDHOWHo'></script>
  <meta charset="UTF-8">
  <title>OS-P - Faux OS en HTML</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --accent: #4caf50;
      --accent-dark: #2e7d32;
      --bg-desktop: radial-gradient(circle at top left, #202840, #050813);
      --text: #f5f5f5;
      --window-bg: #121826;
      --taskbar-bg: rgba(8, 10, 20, 0.95);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
                   Roboto, sans-serif;
    }

    body, html {
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: #000;
      color: var(--text);
    }

    body {
      display: flex;
      flex-direction: column;
    }

    /* BUREAU */

    #desktop {
      position: relative;
      flex: 1;
      background: var(--bg-desktop);
      background-size: cover;
      padding: 0.75rem;
      display: flex;
      flex-wrap: wrap;
      align-content: flex-start;
      gap: 0.5rem;
    }

    .desktop-icon {
      width: 4.2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      cursor: pointer;
      user-select: none;
      transition: transform 0.15s ease, background 0.15s ease;
      border-radius: 0.75rem;
      padding: 0.3rem 0.25rem;
    }

    .desktop-icon:hover {
      background: rgba(255,255,255,0.06);
      transform: translateY(-2px);
    }

    .desktop-icon:active {
      transform: scale(0.96);
      background: rgba(255,255,255,0.09);
    }

    .desktop-icon-emoji {
      font-size: 1.6rem;
      margin-bottom: 0.25rem;
      text-shadow: 0 0 6px rgba(0,0,0,0.6);
    }

    .desktop-icon-label {
      font-size: 0.72rem;
      line-height: 1.2;
      text-shadow: 0 0 3px rgba(0,0,0,0.9);
      word-break: break-word;
    }

    /* BARRE DES T√ÇCHES */

    #taskbar {
      height: 2.5rem;
      background: var(--taskbar-bg);
      border-top: 1px solid rgba(255,255,255,0.08);
      display: flex;
      align-items: center;
      padding: 0 0.4rem;
      gap: 0.4rem;
      backdrop-filter: blur(12px);
    }

    #startBtn {
      border: none;
      background: var(--accent);
      color: #fff;
      font-weight: 600;
      padding: 0.4rem 0.7rem;
      border-radius: 999px;
      display: flex;
      align-items: center;
      gap: 0.4rem;
      cursor: pointer;
      box-shadow: 0 0 0 1px rgba(0,0,0,0.4),
                  0 6px 16px rgba(0,0,0,0.42);
      font-size: 0.85rem;
    }

    #startBtn span.logo {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 1.1rem;
      height: 1.1rem;
      border-radius: 0.3rem;
      background: radial-gradient(circle at 30% 20%, #fff, #00ffb3 60%, #006cff 100%);
      box-shadow: 0 0 8px rgba(0,255,179,0.7);
      font-size: 0.8rem;
    }

    #startBtn:active {
      background: var(--accent-dark);
      transform: translateY(1px);
    }

    #taskbar-windows {
      flex: 1;
      display: flex;
      gap: 0.25rem;
      overflow-x: auto;
      scrollbar-width: none;
    }

    #taskbar-windows::-webkit-scrollbar {
      display: none;
    }

    .taskbar-item {
      border: none;
      background: transparent;
      color: #f5f5f5;
      font-size: 0.78rem;
      padding: 0.2rem 0.6rem;
      border-radius: 999px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.25rem;
      opacity: 0.8;
      white-space: nowrap;
    }

    .taskbar-item.active {
      background: rgba(255,255,255,0.08);
      opacity: 1;
    }

    .taskbar-item span.icon {
      font-size: 1rem;
    }

    #clock {
      min-width: 3.5rem;
      text-align: right;
      font-size: 0.75rem;
      opacity: 0.9;
      font-variant-numeric: tabular-nums;
    }

    /* MENU DEMARRER */

    #startMenu {
      position: fixed;
      left: 0.4rem;
      bottom: 2.7rem;
      width: min(16rem, 90vw);
      background: rgba(5, 8, 20, 0.98);
      border-radius: 1rem;
      box-shadow: 0 20px 60px rgba(0,0,0,0.65);
      padding: 0.75rem;
      border: 1px solid rgba(255,255,255,0.08);
      backdrop-filter: blur(14px);
      z-index: 10000;
    }

    #startMenu.hidden {
      display: none;
    }

    .start-title {
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      opacity: 0.8;
      margin-bottom: 0.35rem;
    }

    .start-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(6rem, 1fr));
      gap: 0.4rem;
    }

    .start-app {
      border-radius: 0.9rem;
      background: rgba(255,255,255,0.04);
      padding: 0.4rem 0.5rem;
      cursor: pointer;
      display: flex;
      gap: 0.4rem;
      align-items: center;
      font-size: 0.8rem;
      transition: background 0.15s ease, transform 0.15s ease;
    }

    .start-app:hover {
      background: rgba(255,255,255,0.09);
      transform: translateY(-1px);
    }

    .start-app span.icon {
      font-size: 1.25rem;
    }

    .start-app span.label {
      display: block;
      line-height: 1.3;
    }

    .start-footer {
      margin-top: 0.5rem;
      border-top: 1px solid rgba(255,255,255,0.08);
      padding-top: 0.4rem;
      font-size: 0.7rem;
      opacity: 0.7;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    /* FEN√äTRES */

    .window {
      position: absolute;
      min-width: min(18rem, 95vw);
      max-width: min(26rem, 95vw);
      min-height: 9rem;
      background: var(--window-bg);
      border-radius: 1rem;
      border: 1px solid rgba(255,255,255,0.14);
      box-shadow: 0 20px 60px rgba(0,0,0,0.75);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      animation: pop 0.15s ease-out;
    }

    @keyframes pop {
      from {
        transform: scale(0.94) translateY(8px);
        opacity: 0;
      }
      to {
        transform: scale(1) translateY(0);
        opacity: 1;
      }
    }

    .window-titlebar {
      height: 2rem;
      display: flex;
      align-items: center;
      padding: 0 0.6rem;
      gap: 0.4rem;
      background: radial-gradient(circle at top left, rgba(255,255,255,0.12), rgba(0,0,0,0.85));
      cursor: move;
      user-select: none;
    }

    .window-dot {
      width: 0.5rem;
      height: 0.5rem;
      border-radius: 999px;
      background: #ff5f57;
      box-shadow:
        0 0 0 1px rgba(0,0,0,0.7),
        0 0 10px rgba(255,95,87,0.5);
    }

    .window-dot:nth-child(2) {
      background: #febc2e;
      box-shadow:
        0 0 0 1px rgba(0,0,0,0.7),
        0 0 10px rgba(254,188,46,0.5);
    }

    .window-dot:nth-child(3) {
      background: #28c840;
      box-shadow:
        0 0 0 1px rgba(0,0,0,0.7),
        0 0 10px rgba(40,200,64,0.5);
    }

    .window-title {
      flex: 1;
      text-align: center;
      font-size: 0.8rem;
      opacity: 0.9;
    }

    .window-buttons {
      display: flex;
      gap: 0.2rem;
    }

    .window-btn {
      border: none;
      background: transparent;
      color: #fff;
      width: 1.3rem;
      height: 1.3rem;
      border-radius: 999px;
      font-size: 0.85rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0.7;
    }

    .window-btn:hover {
      background: rgba(255,255,255,0.12);
      opacity: 1;
    }

    .window-content {
      padding: 0.6rem 0.7rem;
      font-size: 0.82rem;
      line-height: 1.4;
      overflow: auto;
      flex: 1;
    }

    /* APPLI : BLOC-NOTES */

    .notes-textarea {
      width: 100%;
      min-height: 8rem;
      border-radius: 0.75rem;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(0,0,0,0.45);
      padding: 0.5rem;
      color: #f5f5f5;
      resize: vertical;
      font-size: 0.8rem;
    }

    .notes-textarea:focus {
      outline: 1px solid var(--accent);
      box-shadow: 0 0 0 1px rgba(0,0,0,0.8),
                  0 0 12px rgba(76,175,80,0.55);
    }

    .btn-primary {
      border: none;
      background: var(--accent);
      color: #fff;
      border-radius: 999px;
      padding: 0.35rem 0.7rem;
      font-size: 0.78rem;
      cursor: pointer;
      margin-top: 0.35rem;
    }

    .btn-primary:active {
      background: var(--accent-dark);
      transform: translateY(1px);
    }

    .helper-text {
      font-size: 0.7rem;
      opacity: 0.7;
      margin-top: 0.25rem;
    }

    .btn-ghost {
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.2);
      background: rgba(0,0,0,0.4);
      color: #f5f5f5;
      font-size: 0.78rem;
      padding: 0.25rem 0.6rem;
      cursor: pointer;
    }

    .btn-ghost:active {
      background: rgba(255,255,255,0.1);
    }

    /* APPLI : EXPLORATEUR */

    .file-toolbar {
      display: flex;
      gap: 0.4rem;
      flex-wrap: wrap;
      align-items: center;
      margin: 0.35rem 0;
    }

    .file-list {
      list-style: none;
      margin-top: 0.4rem;
      border-radius: 0.75rem;
      border: 1px solid rgba(255,255,255,0.14);
      overflow: hidden;
      max-height: 13rem;
      overflow-y: auto;
    }

    .file-item {
      display: flex;
      align-items: center;
      padding: 0.3rem 0.5rem;
      gap: 0.4rem;
      font-size: 0.8rem;
      background: rgba(255,255,255,0.02);
      border-bottom: 1px solid rgba(255,255,255,0.05);
      cursor: pointer;
    }

    .file-item:hover {
      background: rgba(255,255,255,0.08);
    }

    .file-item:last-child {
      border-bottom: none;
    }

    .file-item span.icon {
      font-size: 1rem;
    }

    .file-meta {
      font-size: 0.7rem;
      opacity: 0.7;
    }

    .file-empty {
      font-size: 0.8rem;
      opacity: 0.7;
      margin-top: 0.4rem;
    }

    /* APPLI : PARAM√àTRES */

    .settings-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(4rem, 1fr));
      gap: 0.4rem;
      margin-top: 0.35rem;
    }

    .settings-swatch {
      height: 2rem;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.2);
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .settings-swatch span {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      text-shadow: 0 0 4px rgba(0,0,0,0.8);
    }

    /* APPLI : VISIONNEUSE */

    .viewer-header {
      font-size: 0.8rem;
      margin-bottom: 0.3rem;
      opacity: 0.85;
      word-break: break-all;
    }

    .viewer-meta {
      font-size: 0.7rem;
      opacity: 0.7;
      margin-bottom: 0.3rem;
    }

    .viewer-box {
      border-radius: 0.75rem;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(0,0,0,0.55);
      padding: 0.4rem;
      max-height: 16rem;
      overflow: auto;
    }

    .viewer-box pre {
      white-space: pre-wrap;
      font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.78rem;
    }

    .viewer-image-wrap {
      display: flex;
      justify-content: center;
      align-items: center;
      max-height: 16rem;
      overflow: auto;
    }

    .viewer-image-wrap img {
      max-width: 100%;
      max-height: 16rem;
      border-radius: 0.5rem;
    }

    /* APPLI : KALI MODE */

    .kali-banner {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.78rem;
      padding: 0.25rem 0.5rem;
      border-radius: 0.6rem;
      background: linear-gradient(90deg,#000,#041c14,#000);
      border: 1px solid rgba(0,255,179,0.4);
      margin-bottom: 0.4rem;
    }

    .kali-banner strong {
      color: #00ffb3;
    }

    .kali-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      align-items: center;
      margin-bottom: 0.4rem;
    }

    .kali-controls input[type="number"] {
      width: 4rem;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.25);
      background: rgba(0,0,0,0.6);
      color: #f5f5f5;
      font-size: 0.75rem;
      padding: 0.15rem 0.4rem;
    }

    .kali-exports {
      display: flex;
      flex-wrap: wrap;
      gap: 0.35rem;
      margin-bottom: 0.4rem;
    }

    .kali-report-box {
      border-radius: 0.75rem;
      border: 1px solid rgba(0,255,179,0.4);
      background: radial-gradient(circle at top left, rgba(0,0,0,0.9), rgba(0,20,10,0.9));
      padding: 0.4rem;
      max-height: 16rem;
      overflow: auto;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.78rem;
    }

    .kali-report-box pre {
      white-space: pre-wrap;
    }

    .kali-status {
      font-size: 0.72rem;
      opacity: 0.78;
      margin-bottom: 0.3rem;
    }

    /* APPLI : ALERTE CYBER */

.cyber-report-box {
  border-radius: 0.75rem;
  border: 1px solid rgba(255,0,86,0.5);
  background: radial-gradient(circle at top left, rgba(38,0,15,0.95), rgba(4,0,10,0.95));
  padding: 0.4rem;
  max-height: 12rem;
  overflow: auto;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size: 0.78rem;
  margin-top: 0.4rem;
}

.cyber-report-box pre {
  white-space: pre-wrap;
}

.cyber-grid {
  display: grid;
  grid-template-columns: minmax(0,1fr);
  gap: 0.4rem;
  margin-top: 0.5rem;
}

@media (min-width: 700px) {
  .cyber-grid {
    grid-template-columns: repeat(2, minmax(0,1fr));
  }
}

.cyber-card {
  border-radius: 0.8rem;
  border: 1px solid rgba(255,255,255,0.16);
  background: rgba(0,0,0,0.6);
  padding: 0.45rem 0.55rem;
  font-size: 0.78rem;
}

.cyber-card-title {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-weight: 600;
  margin-bottom: 0.2rem;
}

.badge {
  font-size: 0.65rem;
  border-radius: 999px;
  padding: 0.05rem 0.4rem;
}

.badge-high {
  background: rgba(255,0,86,0.2);
  border: 1px solid rgba(255,0,86,0.6);
  color: #ff5c88;
}

.badge-medium {
  background: rgba(255,171,0,0.2);
  border: 1px solid rgba(255,171,0,0.6);
  color: #ffcf5c;
}

.badge-low {
  background: rgba(0,255,179,0.18);
  border: 1px solid rgba(0,255,179,0.6);
  color: #6bffd1;
}

.cyber-quiz {
  margin-top: 0.6rem;
  border-radius: 0.75rem;
  border: 1px dashed rgba(255,255,255,0.25);
  padding: 0.45rem 0.55rem;
  font-size: 0.78rem;
}

.cyber-quiz-q {
  margin-top: 0.35rem;
}

.cyber-quiz-q strong {
  display: block;
  margin-bottom: 0.15rem;
}

.cyber-quiz-buttons {
  display: flex;
  flex-wrap: wrap;
  gap: 0.3rem;
  margin-top: 0.15rem;
}

.cyber-quiz-feedback {
  margin-top: 0.25rem;
  font-size: 0.72rem;
  opacity: 0.85;
}



    /* MOBILE */

    @media (max-width: 600px) {
      #desktop {
        padding-bottom: 0.3rem;
        gap: 0.4rem;
      }

      .desktop-icon {
        width: 3.4rem;
      }

      .window {
        min-width: 95vw;
        max-width: 95vw;
        left: 2.5vw !important;
      }

      .window-content {
        font-size: 0.8rem;
      }
    }
  </style>
</head>
<body>
  <div id="desktop"></div>

  <!-- Menu d√©marrer -->
  <div id="startMenu" class="hidden">
    <div class="start-title">Applications</div>
    <div class="start-grid" id="startAppGrid"></div>
    <div class="start-footer">
      <span>OS-P ‚Ä¢ Session locale</span>
      <span style="opacity:.5;">HTML/CSS/JS only</span>
    </div>
  </div>

  <!-- Barre des t√¢ches -->
  <div id="taskbar">
    <button id="startBtn">
      <span class="logo">P</span>
      <span>Menu</span>
    </button>
    <div id="taskbar-windows"></div>
    <div id="clock"></div>
  </div>

  <!-- Template fen√™tre -->
  <template id="windowTemplate">
    <div class="window">
      <div class="window-titlebar">
        <div style="display:flex;gap:0.2rem;">
          <div class="window-dot"></div>
          <div class="window-dot"></div>
          <div class="window-dot"></div>
        </div>
        <div class="window-title"></div>
        <div class="window-buttons">
          <button class="window-btn" data-action="minimize">‚ñÅ</button>
          <button class="window-btn" data-action="close">‚úï</button>
        </div>
      </div>
      <div class="window-content"></div>
    </div>
  </template>

  <script>
    // === "OS" CONFIG ========================================================
    const FILE_REGISTRY = {};
    let FILE_ID_COUNTER = 0;

    const APPS = [
  {
    id: "about",
    name: "√Ä propos",
    icon: "üíª",
    open: createAboutApp
  },
  {
    id: "notes",
    name: "Bloc-notes",
    icon: "üìù",
    open: createNotesApp
  },
  {
    id: "explorer",
    name: "Explorateur",
    icon: "üìÅ",
    open: createExplorerApp
  },
  {
    id: "viewer",
    name: "Visionneuse",
    icon: "üëÅÔ∏è",
    open: createViewerApp
  },
  {
    id: "cyber",
    name: "Alerte Cyber",
    icon: "üö®",
    open: createCyberApp
  },
  {
    id: "kali",
    name: "Mode Kali",
    icon: "üêâ",
    open: createKaliApp
  },
  {
    id: "settings",
    name: "Param√®tres",
    icon: "‚öôÔ∏è",
    open: createSettingsApp
  },
  {
    id: "terminal",
    name: "Console",
    icon: ">_",
    open: createTerminalApp
  }
];


    const STATE = {
      windows: {},
      zIndexCounter: 10
    };

    const $desktop = document.getElementById("desktop");
    const $startBtn = document.getElementById("startBtn");
    const $startMenu = document.getElementById("startMenu");
    const $startAppGrid = document.getElementById("startAppGrid");
    const $taskWindows = document.getElementById("taskbar-windows");
    const $clock = document.getElementById("clock");
    const $windowTemplate = document.getElementById("windowTemplate");

    // === UTILITAIRES G√âN√âRALES =============================================

    function bringToFront(win) {
      STATE.zIndexCounter += 1;
      win.style.zIndex = STATE.zIndexCounter;
      const id = win.dataset.appId;
      for (const btn of $taskWindows.querySelectorAll(".taskbar-item")) {
        btn.classList.toggle("active", btn.dataset.appId === id);
      }
    }

    function updateClock() {
      const d = new Date();
      const h = String(d.getHours()).padStart(2, "0");
      const m = String(d.getMinutes()).padStart(2, "0");
      $clock.textContent = `${h}:${m}`;
    }

    setInterval(updateClock, 10000);
    updateClock();

    function toggleStartMenu(forceHide = false) {
      if (forceHide) {
        $startMenu.classList.add("hidden");
        return;
      }
      $startMenu.classList.toggle("hidden");
    }

    document.addEventListener("click", (e) => {
      if (
        !$startMenu.contains(e.target) &&
        !$startBtn.contains(e.target)
      ) {
        $startMenu.classList.add("hidden");
      }
    });

    $startBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      toggleStartMenu();
    });

    // === FEN√äTRES ===========================================================

    function createWindow(appConfig) {
      const existing = STATE.windows[appConfig.id];
      if (existing) {
        existing.element.style.display = "flex";
        bringToFront(existing.element);
        return existing.element;
      }

      const tpl = $windowTemplate.content.firstElementChild.cloneNode(true);
      tpl.dataset.appId = appConfig.id;

      const x = 40 + Math.random() * 80;
      const y = 40 + Math.random() * 40;
      tpl.style.left = x + "px";
      tpl.style.top = y + "px";

      const titleEl = tpl.querySelector(".window-title");
      titleEl.textContent = appConfig.name;

      const contentEl = tpl.querySelector(".window-content");
      appConfig.open(contentEl);

      tpl.querySelectorAll(".window-btn").forEach(btn => {
        const action = btn.dataset.action;
        btn.addEventListener("click", () => {
          if (action === "close") {
            closeWindow(appConfig.id);
          } else if (action === "minimize") {
            tpl.style.display = "none";
          }
        });
      });

      tpl.addEventListener("mousedown", () => bringToFront(tpl));
      makeWindowDraggable(tpl);
      $desktop.appendChild(tpl);
      bringToFront(tpl);

      const tbBtn = document.createElement("button");
      tbBtn.className = "taskbar-item active";
      tbBtn.dataset.appId = appConfig.id;
      tbBtn.innerHTML =
        `<span class="icon">${appConfig.icon}</span><span>${appConfig.name}</span>`;
      tbBtn.addEventListener("click", () => {
        if (tpl.style.display === "none") {
          tpl.style.display = "flex";
          bringToFront(tpl);
        } else {
          tpl.style.display = "none";
          tbBtn.classList.remove("active");
        }
      });
      $taskWindows.appendChild(tbBtn);

      STATE.windows[appConfig.id] = {
        element: tpl,
        taskButton: tbBtn,
        config: appConfig
      };

      return tpl;
    }

    function closeWindow(appId) {
      const win = STATE.windows[appId];
      if (!win) return;
      win.element.remove();
      win.taskButton.remove();
      delete STATE.windows[appId];
    }

    function makeWindowDraggable(win) {
      const titlebar = win.querySelector(".window-titlebar");
      let isDragging = false;
      let offsetX = 0;
      let offsetY = 0;

      titlebar.addEventListener("mousedown", (e) => {
        if (e.target.closest(".window-buttons")) return;
        isDragging = true;
        bringToFront(win);
        const rect = win.getBoundingClientRect();
        offsetX = e.clientX - rect.left;
        offsetY = e.clientY - rect.top;
        document.body.style.userSelect = "none";
      });

      document.addEventListener("mousemove", (e) => {
        if (!isDragging) return;
        const x = e.clientX - offsetX;
        const y = e.clientY - offsetY;
        win.style.left = x + "px";
        win.style.top = y + "px";
      });

      document.addEventListener("mouseup", () => {
        isDragging = false;
        document.body.style.userSelect = "";
      });
    }

    // === APPLI : √Ä PROPOS ===================================================

    function createAboutApp(container) {
      container.innerHTML = `
        <p><strong>OS-P</strong> est un mini syst√®me d‚Äôexploitation
        100% HTML/CSS/JS, qui tourne dans ton navigateur.</p>
        <p style="margin-top:0.4rem;">
          Tu peux ouvrir des fen√™tres, les d√©placer, prendre des notes,
          explorer de vrais dossiers locaux, afficher des fichiers
          et analyser ta session avec le <strong>Mode Kali</strong>.
        </p>
        <p style="margin-top:0.4rem;font-size:0.78rem;opacity:.8;">
          L‚ÄôOS n‚Äôacc√®de qu‚Äôaux infos que ton navigateur expose (user-agent,
          langue, r√©solution, stockage estim√©, etc.). Pas d‚ÄôIP ni de donn√©es
          r√©seau directes, pas d‚Äôenvoi sur un serveur : tout reste local.
        </p>
      `;
    }

    // === APPLI : NOTES ======================================================

    const NOTES_KEY = "os_p_notes";

    function createNotesApp(container) {
      const saved = localStorage.getItem(NOTES_KEY) || "";
      container.innerHTML = `
        <p><strong>Bloc-notes OS-P</strong></p>
        <textarea class="notes-textarea" id="notesArea"
          placeholder="√âcris ici tout ce qui te passe par la t√™te...">${saved}</textarea>
        <button class="btn-primary" id="saveNotesBtn">üíæ Sauvegarder</button>
        <div class="helper-text">
          Les notes sont enregistr√©es dans <code>localStorage</code> sur ce navigateur.
        </div>
      `;

      const textarea = container.querySelector("#notesArea");
      const btn = container.querySelector("#saveNotesBtn");

      function save() {
        localStorage.setItem(NOTES_KEY, textarea.value);
      }

      btn.addEventListener("click", save);
      textarea.addEventListener("keydown", (e) => {
        if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === "s") {
          e.preventDefault();
          save();
        }
      });
    }

    // === VISIONNEUSE : RENDU DE FICHIERS ====================================

    function openFileInViewer(fileId, path) {
      const file = FILE_REGISTRY[fileId];
      if (!file) {
        alert("Fichier introuvable.");
        return;
      }

      const viewerApp = APPS.find(a => a.id === "viewer");
      let viewerWin = STATE.windows["viewer"]?.element;
      if (!viewerWin) {
        viewerWin = createWindow(viewerApp);
      } else {
        viewerWin.style.display = "flex";
        bringToFront(viewerWin);
      }
      const container = viewerWin.querySelector(".window-content");
      renderFileInViewer(container, file, path);
    }

    function renderFileInViewer(container, file, path) {
      const name = file.name.toLowerCase();
      const type = file.type || "";
      const ext = (name.includes(".") ? name.split(".").pop() : "").toLowerCase();
      const sizeKB = (file.size / 1024).toFixed(1);

      const isImage = type.startsWith("image/") ||
                      ["png","jpg","jpeg","gif","webp","svg"].includes(ext);
      const isAudio = type.startsWith("audio/") ||
                      ["mp3","wav","ogg"].includes(ext);
      const isVideo = type.startsWith("video/") ||
                      ["mp4","webm","ogv"].includes(ext);
      const isPdf   = type === "application/pdf" || ext === "pdf";
      const isText  =
        type.startsWith("text/") ||
        ["txt","md","json","csv","html","css","js"].includes(ext);

      const baseHeader = `
        <div class="viewer-header"><strong>${path}</strong></div>
        <div class="viewer-meta">
          Nom : ${file.name} ¬∑ Taille : ${sizeKB} ko
        </div>
      `;

      if (isImage) {
        const url = URL.createObjectURL(file);
        container.innerHTML = baseHeader + `
          <div class="viewer-image-wrap">
            <img src="${url}" alt="${file.name}">
          </div>
        `;
        return;
      }

      if (isAudio) {
        const url = URL.createObjectURL(file);
        container.innerHTML = baseHeader + `
          <div class="viewer-box">
            <audio controls style="width:100%;">
              <source src="${url}">
              Ton navigateur ne supporte pas l‚Äô√©l√©ment audio.
            </audio>
          </div>
        `;
        return;
      }

      if (isVideo) {
        const url = URL.createObjectURL(file);
        container.innerHTML = baseHeader + `
          <div class="viewer-box">
            <video controls style="width:100%;max-height:14rem;">
              <source src="${url}">
              Ton navigateur ne supporte pas l‚Äô√©l√©ment vid√©o.
            </video>
          </div>
        `;
        return;
      }

      if (isPdf) {
        const url = URL.createObjectURL(file);
        container.innerHTML = baseHeader + `
          <div class="viewer-box" style="padding:0;max-height:none;">
            <embed src="${url}" type="application/pdf"
                   style="width:100%;height:18rem;border-radius:0.75rem;">
            </embed></div>
          <div class="helper-text" style="margin-top:0.3rem;">
            Si le PDF ne s‚Äôaffiche pas, essaie un autre navigateur ou
            t√©l√©charge le fichier depuis l‚Äôexplorateur classique.
          </div>
        `;
        return;
      }

      if (isText) {
        container.innerHTML = baseHeader + `
          <div class="viewer-box">
            <pre id="viewerText"></pre>
          </div>
        `;
        const pre = container.querySelector("#viewerText");
        const reader = new FileReader();
        reader.onload = () => {
          pre.textContent = reader.result;
        };
        reader.onerror = () => {
          pre.textContent = "[Erreur de lecture du fichier texte]";
        };
        reader.readAsText(file, "utf-8");
        return;
      }

      container.innerHTML = baseHeader + `
        <div class="viewer-box">
          <p>Type non g√©r√© pour la pr√©visualisation.</p>
          <p class="helper-text">
            Extension : <code>.${ext || "?"}</code> ‚Äî type MIME : <code>${type || "inconnu"}</code>.
          </p>
        </div>
      `;
    }

    // === APPLI : EXPLORATEUR ================================================

    function createExplorerApp(container) {
      container.innerHTML = `
        <p><strong>Explorateur de fichiers</strong></p>
        <div class="helper-text">
          Choisis un dossier (ou des fichiers) sur ton disque.
          Rien ne quitte ton navigateur, on ne voit que des copies temporaires.
        </div>
        <div class="file-toolbar">
          <button class="btn-ghost" id="pickDirBtn">üìÇ Choisir un dossier</button>
          <span id="explorerSummary" style="font-size:0.75rem;opacity:.75;"></span>
        </div>
        <input type="file" id="dirInput" style="display:none;" webkitdirectory multiple>
        <ul class="file-list" id="fileList"></ul>
        <div class="file-empty" id="fileEmpty">
          Aucun fichier charg√© pour l‚Äôinstant. Clique sur ¬´ Choisir un dossier ¬ª.
        </div>
      `;

      const pickBtn = container.querySelector("#pickDirBtn");
      const input = container.querySelector("#dirInput");
      const list = container.querySelector("#fileList");
      const empty = container.querySelector("#fileEmpty");
      const summary = container.querySelector("#explorerSummary");

      pickBtn.addEventListener("click", () => {
        input.click();
      });

      input.addEventListener("change", () => {
        const files = Array.from(input.files || []);
        FILE_ID_COUNTER++;
        const sessionId = FILE_ID_COUNTER;

        list.innerHTML = "";
        FILE_REGISTRY_CLEAR();

        if (!files.length) {
          empty.style.display = "block";
          summary.textContent = "";
          return;
        }

        files.sort((a, b) => {
          const pa = a.webkitRelativePath || a.name;
          const pb = b.webkitRelativePath || b.name;
          return pa.localeCompare(pb);
        });

        files.forEach(file => {
          const path = file.webkitRelativePath || file.name;
          const depth = (path.split("/").length - 1);
          const fileId = registerFile(file);

          const li = document.createElement("li");
          li.className = "file-item";
          li.dataset.fileId = fileId;
          li.title = path;

          const icon = guessFileIcon(file);

          li.innerHTML = `
            <span class="icon">${icon}</span>
            <div style="flex:1;">
              <div style="padding-left:${depth * 0.7}rem;">${path}</div>
              <div class="file-meta">${(file.size/1024).toFixed(1)} ko</div>
            </div>
          `;

          li.addEventListener("click", () => openFileInViewer(fileId, path));
          list.appendChild(li);
        });

        empty.style.display = "none";
        summary.textContent = `${files.length} fichier(s) ‚Äì session #${sessionId}`;
      });
    }

    function registerFile(file) {
      const id = "f" + Date.now() + "_" + Math.random().toString(16).slice(2);
      FILE_REGISTRY[id] = file;
      return id;
    }

    function FILE_REGISTRY_CLEAR() {
      for (const key of Object.keys(FILE_REGISTRY)) {
        delete FILE_REGISTRY[key];
      }
    }

    function guessFileIcon(file) {
      const name = file.name.toLowerCase();
      const ext = (name.includes(".") ? name.split(".").pop() : "").toLowerCase();
      const type = file.type || "";

      if (type.startsWith("image/") || ["png","jpg","jpeg","gif","webp","svg"].includes(ext)) return "üñºÔ∏è";
      if (type.startsWith("audio/") || ["mp3","wav","ogg"].includes(ext)) return "üéµ";
      if (type.startsWith("video/") || ["mp4","webm","ogv"].includes(ext)) return "üé¨";
      if (ext === "pdf") return "üìÑ";
      if (["txt","md"].includes(ext)) return "üìú";
      if (["csv","xls","xlsx"].includes(ext)) return "üìä";
      if (["html","css","js","json"].includes(ext)) return "üß©";
      return "üìÅ";
    }

    // === APPLI : VISIONNEUSE ================================================

    function createViewerApp(container) {
      container.innerHTML = `
        <p><strong>Visionneuse de fichiers</strong></p>
        <p class="helper-text">
          S√©lectionne un fichier dans l‚ÄôExplorateur pour l‚Äôafficher ici.
        </p>
        <div class="viewer-box" style="margin-top:0.4rem;">
          <p>En attente de fichier‚Ä¶</p>
        </div>
      `;
    }

    // === APPLI : MODE KALI ==================================================

    function generateSessionReportBase() {
      const nav = navigator || {};
      const screenObj = window.screen || {};
      const dtOptions = Intl.DateTimeFormat().resolvedOptions?.() || {};

      const report = {
        generatedAt: new Date().toISOString(),
        localeTime: new Date().toString(),
        timeZone: dtOptions.timeZone || null,
        languages: {
          primary: nav.language || null,
          all: nav.languages || null
        },
        userAgent: nav.userAgent || null,
        platform: nav.platform || null,
        hardware: {
          cores: nav.hardwareConcurrency ?? null,
          deviceMemoryGB: nav.deviceMemory ?? null
        },
        screen: {
          width: screenObj.width,
          height: screenObj.height,
          availWidth: screenObj.availWidth,
          availHeight: screenObj.availHeight,
          pixelRatio: window.devicePixelRatio
        },
        onlineStatus: {
          online: nav.onLine,
          cookiesEnabled: nav.cookieEnabled
        },
        storageEstimate: null,
        locationHint: {
          // juste des indices : pas d'IP, pas de g√©oloc automatique ici
          timezone: dtOptions.timeZone || null,
          language: nav.language || null
        }
      };

      return report;
    }

    function enrichReportWithStorage(report, cb) {
      if (navigator.storage && navigator.storage.estimate) {
        navigator.storage.estimate().then(est => {
          report.storageEstimate = {
            quota: est.quota ?? null,
            usage: est.usage ?? null
          };
          cb(report);
        }).catch(() => cb(report));
      } else {
        cb(report);
      }
    }

    function formatReportHuman(report) {
      const lines = [];
      lines.push(`# Session OS-P`);
      lines.push(`Horodatage      : ${report.generatedAt}`);
      lines.push(`Heure locale    : ${report.localeTime}`);
      lines.push(`Fuseau horaire  : ${report.timeZone || "?"}`);
      lines.push("");
      lines.push(`## Navigateur`);
      lines.push(`User-Agent      : ${report.userAgent || "?"}`);
      lines.push(`Plateforme      : ${report.platform || "?"}`);
      lines.push(`Langue principale : ${report.languages.primary || "?"}`);
      lines.push(`Langues         : ${(report.languages.all || []).join(", ") || "?"}`);
      lines.push("");
      lines.push(`## Mat√©riel (expos√© par le navigateur)`);
      lines.push(`C≈ìurs logiques  : ${report.hardware.cores ?? "?"}`);
      lines.push(`M√©moire (deviceMemory) : ${report.hardware.deviceMemoryGB ?? "?"} GiB (approx)`);
      lines.push("");
      lines.push(`## √âcran`);
      lines.push(`R√©solution      : ${report.screen.width} x ${report.screen.height}`);
      lines.push(`Zone dispo      : ${report.screen.availWidth} x ${report.screen.availHeight}`);
      lines.push(`Pixel ratio     : ${report.screen.pixelRatio}`);
      lines.push("");
      lines.push(`## Statut & stockage`);
      lines.push(`En ligne        : ${report.onlineStatus.online ? "oui" : "non"}`);
      lines.push(`Cookies activ√©s : ${report.onlineStatus.cookiesEnabled ? "oui" : "non"}`);
      if (report.storageEstimate) {
        const { quota, usage } = report.storageEstimate;
        const qMB = quota ? (quota / (1024*1024)).toFixed(1) : "?";
        const uMB = usage ? (usage / (1024*1024)).toFixed(1) : "?";
        lines.push(`Stockage estim√© : ${uMB}/${qMB} Mo utilis√©s`);
      } else {
        lines.push(`Stockage estim√© : non disponible`);
      }
      lines.push("");
      lines.push(`## Indices de localisation (via navigateur)`);
      lines.push(`Fuseau          : ${report.locationHint.timezone || "?"}`);
      lines.push(`Langue          : ${report.locationHint.language || "?"}`);
      lines.push("");
      lines.push(`(Aucune IP ni g√©olocalisation r√©seau n‚Äôest accessible depuis ce faux OS.)`);
      return lines.join("\n");
    }

    function formatReportJSON(report) {
      return JSON.stringify(report, null, 2);
    }

    function formatReportMD(report) {
      const human = formatReportHuman(report);
      return human.replace(/^# /, "# Rapport Kali OS-P\n\n");
    }

    function formatReportTXT(report) {
      // version texte simplifi√©e = m√™me base sans les h2
      return formatReportHuman(report)
        .replace(/^#.*$/m, "=== Rapport de session OS-P ===")
        .replace(/^## .+$/gm, "");
    }

    function formatReportCSV(report) {
      const flat = {};
      function add(prefix, obj) {
        Object.entries(obj).forEach(([k,v]) => {
          if (v && typeof v === "object" && !Array.isArray(v)) {
            add(prefix ? `${prefix}.${k}` : k, v);
          } else {
            flat[prefix ? `${prefix}.${k}` : k] = Array.isArray(v) ? v.join("|") : v;
          }
        });
      }
      add("", report);
      const rows = [["key","value"]];
      Object.entries(flat).forEach(([k,v]) => {
        const val = String(v ?? "");
        rows.push([k, val.replace(/"/g,'""')]);
      });
      return rows.map(r => r.map(c => `"${c}"`).join(",")).join("\n");
    }

    function formatReportHTML(report) {
      const flat = {};
      function add(prefix, obj) {
        Object.entries(obj).forEach(([k,v]) => {
          if (v && typeof v === "object" && !Array.isArray(v)) {
            add(prefix ? `${prefix}.${k}` : k, v);
          } else {
            flat[prefix ? `${prefix}.${k}` : k] = Array.isArray(v) ? v.join(", ") : v;
          }
        });
      }
      add("", report);
      const rows = Object.entries(flat).map(
        ([k,v]) => `<tr><td>${k}</td><td>${String(v ?? "")}</td></tr>`
      ).join("");
      return `
<!DOCTYPE html>
<html lang="fr">
<head><meta charset="utf-8"><title>Rapport OS-P</title></head>
<body>
<h1>Rapport de session OS-P (Mode Kali)</h1>
<p>G√©n√©r√© le ${report.generatedAt}</p>
<table border="1" cellspacing="0" cellpadding="4">
<thead><tr><th>Cl√©</th><th>Valeur</th></tr></thead>
<tbody>
${rows}
</tbody>
</table>
</body>
</html>`;
    }

    function triggerDownload(filename, mime, content) {
      const blob = new Blob([content], { type: mime });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function createKaliApp(container) {
      container.innerHTML = `
        <div class="kali-banner">
          <strong>Mode Kali OS-P :</strong> analyse tout ce que le navigateur expose
          sur ta session locale. Aucune donn√©e n‚Äôest envoy√©e √† l‚Äôext√©rieur.
        </div>
        <div class="kali-controls">
          <button class="btn-ghost" id="kaliRefresh">üîç Scanner maintenant</button>
          <span style="font-size:0.75rem;">Intervalle auto (min) :</span>
          <input type="number" id="kaliInterval" min="1" value="5">
          <button class="btn-ghost" id="kaliStartAuto">‚ñ∂Ô∏è Auto</button>
          <button class="btn-ghost" id="kaliStopAuto">‚èπÔ∏è Stop</button>
        </div>
        <div class="kali-status" id="kaliStatus">
          Aucun scan effectu√© pour l‚Äôinstant.
        </div>
        <div class="kali-exports">
          <button class="btn-ghost" data-format="json">üíæ JSON</button>
          <button class="btn-ghost" data-format="txt">üíæ TXT</button>
          <button class="btn-ghost" data-format="md">üíæ Markdown</button>
          <button class="btn-ghost" data-format="csv">üíæ CSV</button>
          <button class="btn-ghost" data-format="html">üíæ HTML</button>
        </div>
        <div class="kali-report-box">
          <pre id="kaliReportBox">En attente de rapport. Clique sur ¬´ Scanner maintenant ¬ª.</pre>
        </div>
        <div class="helper-text" style="margin-top:0.35rem;">
          Limites : pas d‚Äôacc√®s aux processus, pas de scan r√©seau, pas de vrai root.
          C‚Äôest une vue ¬´ navigateur ¬ª de ton environnement, fa√ßon Kali de poche.
        </div>
      `;

      const reportBox = container.querySelector("#kaliReportBox");
      const statusEl = container.querySelector("#kaliStatus");
      const btnRefresh = container.querySelector("#kaliRefresh");
      const intervalInput = container.querySelector("#kaliInterval");
      const btnAuto = container.querySelector("#kaliStartAuto");
      const btnStop = container.querySelector("#kaliStopAuto");
      const exportButtons = container.querySelectorAll(".kali-exports button");

      let currentReport = null;
      let autoTimer = null;
      let autoCount = 0;

      function updateStatus(text) {
        statusEl.textContent = text;
      }

      function render(report) {
        currentReport = report;
        const human = formatReportHuman(report);
        reportBox.textContent = human;
        updateStatus(`Dernier scan : ${new Date().toLocaleTimeString()} ‚Äì Auto : ${autoTimer ? "ON" : "OFF"} ‚Äì #${autoCount}`);
      }

      function doScan() {
        const base = generateSessionReportBase();
        enrichReportWithStorage(base, render);
      }

      btnRefresh.addEventListener("click", () => {
        autoCount++;
        doScan();
      });

      btnAuto.addEventListener("click", () => {
        const mins = parseFloat(intervalInput.value || "0");
        if (!mins || mins <= 0) {
          alert("Intervalle invalide (en minutes).");
          return;
        }
        if (autoTimer) clearInterval(autoTimer);
        const ms = mins * 60 * 1000;
        autoCount = 0;
        doScan();
        autoTimer = setInterval(() => {
          autoCount++;
          doScan();
        }, ms);
        updateStatus(`Auto-scan actif toutes les ${mins} minutes.`);
      });

      btnStop.addEventListener("click", () => {
        if (autoTimer) {
          clearInterval(autoTimer);
          autoTimer = null;
          updateStatus("Auto-scan arr√™t√©.");
        }
      });

      exportButtons.forEach(btn => {
        btn.addEventListener("click", () => {
          const fmt = btn.dataset.format;
          if (!currentReport) {
            alert("Aucun rapport en m√©moire. Lance d‚Äôabord un scan.");
            return;
          }
          const ts = currentReport.generatedAt.replace(/[:.]/g,"-");
          let content = "";
          let mime = "text/plain";
          let filename = `rapport_kali_${fmt}_${ts}.${fmt}`;

          if (fmt === "json") {
            content = formatReportJSON(currentReport);
            mime = "application/json";
          } else if (fmt === "txt") {
            content = formatReportTXT(currentReport);
            mime = "text/plain";
          } else if (fmt === "md") {
            content = formatReportMD(currentReport);
            mime = "text/markdown";
          } else if (fmt === "csv") {
            content = formatReportCSV(currentReport);
            mime = "text/csv";
          } else if (fmt === "html") {
            content = formatReportHTML(currentReport);
            mime = "text/html";
          }

          triggerDownload(filename, mime, content);
        });
      });

      // premier scan direct pour que √ßa ne soit pas vide
      doScan();
    }


    function createCyberApp(container) {
  container.innerHTML = `
    <div class="kali-banner">
      <strong>Alerte Cyber :</strong> ce que ce site (ou n‚Äôimporte quel autre) peut deviner sur toi
      avec de simples infos de navigateur. Tout reste local, c‚Äôest un simulateur de choc p√©dagogique.
    </div>
    <div class="kali-controls">
      <button class="btn-ghost" id="cyberScan">‚ö° Scanner les risques</button>
      <button class="btn-ghost" id="cyberOpenKali">üêâ Vue technique (Mode Kali)</button>
    </div>
    <div class="cyber-report-box">
      <pre id="cyberReportText">En attente de scan. Clique sur ¬´ Scanner les risques ¬ª pour voir ton profil exploitable.</pre>
    </div>

    <div class="cyber-grid">
      <div class="cyber-card">
        <div class="cyber-card-title">
          <span>Suivi publicitaire & profilage</span>
          <span class="badge badge-high">Risque √©lev√©</span>
        </div>
        <div>
          Langue, fuseau horaire, r√©solution d‚Äô√©cran, puissance de la machine‚Ä¶
          crois√©s avec ton historique de navigation, √ßa suffit √† te suivre presque partout
          sans cookies visibles.
        </div>
      </div>

      <div class="cyber-card">
        <div class="cyber-card-title">
          <span>Empreinte num√©rique unique</span>
          <span class="badge badge-medium">Risque moyen</span>
        </div>
        <div>
          Plus ta config est ¬´ rare ¬ª (r√©solution, OS, extensions‚Ä¶), plus tu es identifiable
          comme une empreinte digitale. Changer de VPN ne suffit pas toujours.
        </div>
      </div>

      <div class="cyber-card">
        <div class="cyber-card-title">
          <span>Phishing cibl√©</span>
          <span class="badge badge-high">Risque √©lev√©</span>
        </div>
        <div>
          Conna√Ætre ton syst√®me, ta langue et ton fuseau horaire permet d‚Äôenvoyer un faux mail
          parfaitement cr√©dible (¬´ votre banque ¬ª, ¬´ votre administration locale ¬ª, etc.).
        </div>
      </div>

      <div class="cyber-card">
        <div class="cyber-card-title">
          <span>Fatigue s√©curitaire</span>
          <span class="badge badge-low">Risque sous-estim√©</span>
        </div>
        <div>
          Quand tu es fatigu√©, press√© ou en stress, tu valides plus facilement une fen√™tre
          ou un lien douteux. Le vrai danger, c‚Äôest souvent l‚Äô√©tat dans lequel tu surfes.
        </div>
      </div>
    </div>

    <div class="cyber-quiz">
      <div><strong>Mini quiz de survie cyber :</strong></div>

      <div class="cyber-quiz-q" data-quiz="q1">
        <strong>1. Tu re√ßois un mail ultra cr√©dible qui te presse de cliquer sur un lien :</strong>
        <div class="cyber-quiz-buttons">
          <button class="btn-ghost" data-quiz-answer="q1-wrong1">Je clique, je verrai bien.</button>
          <button class="btn-ghost" data-quiz-answer="q1-right">Je v√©rifie l‚Äôexp√©diteur, l‚ÄôURL et je passe par le site officiel.</button>
          <button class="btn-ghost" data-quiz-answer="q1-wrong2">Je transf√®re √† tous mes contacts pour les pr√©venir.</button>
        </div>
        <div class="cyber-quiz-feedback" id="q1-feedback"></div>
      </div>

      <div class="cyber-quiz-q" data-quiz="q2">
        <strong>2. Tu utilises le m√™me mot de passe partout, mais ¬´ tr√®s compliqu√© ¬ª :</strong>
        <div class="cyber-quiz-buttons">
          <button class="btn-ghost" data-quiz-answer="q2-wrong1">C‚Äôest bon, personne ne le devinera.</button>
          <button class="btn-ghost" data-quiz-answer="q2-right">Mauvaise id√©e : une fuite = toutes mes comptes expos√©s, il faut un gestionnaire.</button>
          <button class="btn-ghost" data-quiz-answer="q2-wrong2">Je le donne √† mes amis, ils surveilleront pour moi.</button>
        </div>
        <div class="cyber-quiz-feedback" id="q2-feedback"></div>
      </div>

      <div class="cyber-quiz-q" data-quiz="q3">
        <strong>3. Tu te connectes sur un Wi-Fi public inconnu :</strong>
        <div class="cyber-quiz-buttons">
          <button class="btn-ghost" data-quiz-answer="q3-wrong1">Je fais tout : banque, mails, administration, sans r√©fl√©chir.</button>
          <button class="btn-ghost" data-quiz-answer="q3-right">Je limite aux usages non sensibles, id√©alement derri√®re un VPN, et je coupe ensuite.</button>
          <button class="btn-ghost" data-quiz-answer="q3-wrong2">Je partage le mot de passe sur les r√©seaux pour ¬´ rendre service ¬ª.</button>
        </div>
        <div class="cyber-quiz-feedback" id="q3-feedback"></div>
      </div>
    </div>
  `;

  const reportEl = container.querySelector("#cyberReportText");
  const btnScan = container.querySelector("#cyberScan");
  const btnKali = container.querySelector("#cyberOpenKali");

  function buildFearReport(report) {
    const ua = report.userAgent || "?";
    const lang = report.languages.primary || "?";
    const tz = report.timeZone || report.locationHint.timezone || "?";
    const cores = report.hardware.cores ?? "?";
    const mem  = report.hardware.deviceMemoryGB ?? "?";
    const sw = report.screen.width;
    const sh = report.screen.height;
    const ratio = report.screen.pixelRatio;

    const lines = [];
    lines.push(`Profil session ‚Äì exploitable par n‚Äôimporte quel site :`);
    lines.push("");
    lines.push(`‚Ä¢ Navigateur : ${ua}`);
    lines.push(`‚Ä¢ Langue & zone : ${lang} ¬∑ ${tz}`);
    lines.push(`‚Ä¢ Mat√©riel expos√© : ${cores} c≈ìurs logiques ¬∑ ~${mem} GiB (approx)`);
    lines.push(`‚Ä¢ √âcran : ${sw}√ó${sh} @ ratio ${ratio}`);
    lines.push("");
    lines.push(`Ce que √ßa permet en pratique :`);
    lines.push(`‚Äì Te reconna√Ætre d‚Äôun site √† l‚Äôautre m√™me sans cookies visibles.`);
    lines.push(`‚Äì Adapter les attaques (phishing, arnaques) √† ta langue et ton contexte.`);
    lines.push(`‚Äì D√©duire si ta machine est ¬´ faible ¬ª ou ¬´ puissante ¬ª (jeu en ligne, crypto, etc.).`);
    lines.push("");
    lines.push(`Bonne nouvelle : tu peux r√©duire l‚Äôempreinte en durcissant ton navigateur,`);
    lines.push(`en limitant les scripts et en s√©parant tes usages (profil boulot / profil perso / navigation sale).`);

    return lines.join("\n");
  }

  function scan() {
    const base = generateSessionReportBase();
    enrichReportWithStorage(base, (report) => {
      reportEl.textContent = buildFearReport(report);
    });
  }

  btnScan.addEventListener("click", scan);

  btnKali.addEventListener("click", () => {
    const kaliApp = APPS.find(a => a.id === "kali");
    if (kaliApp) {
      createWindow(kaliApp);
    }
  });

  // Quiz : feedback rapide
  container.querySelectorAll("[data-quiz-answer]").forEach(btn => {
    btn.addEventListener("click", () => {
      const key = btn.dataset.quizAnswer;
      const qId = key.split("-")[0]; // ex q1, q2, q3
      const feedback = container.querySelector(`#${qId}-feedback`);
      if (!feedback) return;

      if (key.endsWith("right")) {
        feedback.textContent = "‚úîÔ∏è R√©flexe sain : c‚Äôest √ßa qui casse le sc√©nario catastrophe.";
      } else {
        feedback.textContent = "‚ö†Ô∏è C‚Äôest exactement le genre de comportement qui rend les attaques faciles.";
      }
    });
  });
}


    // === APPLI : PARAM√àTRES =================================================

    const WALLPAPER_KEY = "os_p_wallpaper";

    const wallpapers = [
      {
        id: "dark-neon",
        label: "Neon",
        css: "radial-gradient(circle at top left, #202840, #050813)"
      },
      {
        id: "sunset",
        label: "Sunset",
        css: "linear-gradient(135deg, #ff9a9e 0%, #fecfef 30%, #2d1b4c 100%)"
      },
      {
        id: "matrix",
        label: "Matrix",
        css: "repeating-linear-gradient(180deg,#000 0,#020817 10px,#001b14 20px)"
      },
      {
        id: "paper",
        label: "Papier",
        css: "radial-gradient(circle,#fafafa,#d0d0d0)"
      }
    ];

    function applyWallpaper(id) {
      const wp = wallpapers.find(w => w.id === id) || wallpapers[0];
      document.documentElement.style.setProperty("--bg-desktop", wp.css);
      localStorage.setItem(WALLPAPER_KEY, wp.id);
    }

    function createSettingsApp(container) {
      const swatches = wallpapers.map(w => `
        <div class="settings-swatch" data-wp="${w.id}">
          <span>${w.label}</span>
        </div>
      `).join("");

      container.innerHTML = `
        <p><strong>Param√®tres</strong></p>
        <p class="helper-text">
          Change le fond d‚Äô√©cran et joue avec l‚Äôambiance de ton mini-OS.
        </p>
        <div class="settings-grid">
          ${swatches}
        </div>
      `;

      container.querySelectorAll(".settings-swatch").forEach(div => {
        const id = div.dataset.wp;
        const wp = wallpapers.find(w => w.id === id);
        if (wp) {
          div.style.background = wp.css;
        }
        div.addEventListener("click", () => applyWallpaper(id));
      });
    }

    // === APPLI : TERMINAL ===================================================

    function createTerminalApp(container) {
      container.innerHTML = `
        <p><strong>Console OS-P (jouet)</strong></p>
        <p class="helper-text">
          Tape quelques commandes simples : <code>help</code>, <code>whoami</code>, <code>time</code>, <code>clear</code>.
        </p>
        <div id="terminalOutput" style="
          margin-top:0.4rem;
          border-radius:0.75rem;
          border:1px solid rgba(255,255,255,0.2);
          background:rgba(0,0,0,0.7);
          padding:0.4rem;
          font-family: monospace;
          font-size:0.78rem;
          min-height:5rem;
          max-height:10rem;
          overflow:auto;
        "></div>
        <div style="display:flex;gap:0.35rem;margin-top:0.35rem;">
          <span style="font-family:monospace;font-size:0.8rem;opacity:.8;">$</span>
          <input id="terminalInput" type="text" style="
            flex:1;
            border-radius:999px;
            border:1px solid rgba(255,255,255,0.2);
            background:rgba(0,0,0,0.6);
            padding:0.2rem 0.5rem;
            color:#f5f5f5;
            font-family:monospace;
            font-size:0.78rem;
          " placeholder="help">
        </div>
      `;

      const out = container.querySelector("#terminalOutput");
      const input = container.querySelector("#terminalInput");

      function println(text = "") {
        const line = document.createElement("div");
        line.textContent = text;
        out.appendChild(line);
        out.scrollTop = out.scrollHeight;
      }

      println("OS-P shell v0.1");
      println("Tape `help` pour commencer.");

      input.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          const cmd = input.value.trim();
          println(`$ ${cmd}`);
          handleCommand(cmd);
          input.value = "";
        }
      });

      function handleCommand(cmd) {
        const lower = cmd.toLowerCase();
        if (!cmd) return;
        if (lower === "help") {
          println("Commandes : help, whoami, time, clear");
        } else if (lower === "whoami") {
          println("Tu es l'utilisateur¬∑rice root de cet OS imaginaire. üòà");
        } else if (lower === "time") {
          println("Heure actuelle : " + new Date().toLocaleString());
        } else if (lower === "clear") {
          out.innerHTML = "";
        } else {
          println(`Commande inconnue: ${cmd}`);
        }
      }
    }

    // === INIT BUREAU + MENU =================================================

    function initDesktopIcons() {
      APPS.forEach(app => {
        const icon = document.createElement("div");
        icon.className = "desktop-icon";
        icon.innerHTML = `
          <div class="desktop-icon-emoji">${app.icon}</div>
          <div class="desktop-icon-label">${app.name}</div>
        `;
        icon.addEventListener("dblclick", () => createWindow(app));
        icon.addEventListener("touchend", (e) => {
          e.preventDefault();
          createWindow(app);
        });
        $desktop.appendChild(icon);
      });
    }

    function initStartMenu() {
      APPS.forEach(app => {
        const div = document.createElement("div");
        div.className = "start-app";
        div.innerHTML = `
          <span class="icon">${app.icon}</span>
          <span class="label">${app.name}</span>
        `;
        div.addEventListener("click", () => {
          createWindow(app);
          toggleStartMenu(true);
        });
        $startAppGrid.appendChild(div);
      });
    }

    const savedWallpaper = localStorage.getItem(WALLPAPER_KEY);
    if (savedWallpaper) applyWallpaper(savedWallpaper);
    else applyWallpaper("dark-neon");

    initDesktopIcons();
    initStartMenu();

    // Ouvrir √Ä propos au d√©marrage
    createWindow(APPS.find(a => a.id === "about"));
  </script>
</body>
</html>
